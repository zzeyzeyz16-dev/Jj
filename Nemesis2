local OrionLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/Nemesis2/Orion/main/source"))()

local Window = OrionLib:MakeWindow({
    Name = "Legends Rewritten | AutoFarm",
    HidePremium = false,
    SaveConfig = false
})

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

local AutoFarm = false
local AttackRadius = 10
local FarmRange = 60
local Delay = 0.15
local TargetNames = { "NPC", "Enemy", "Mob" } -- Edit if NPC names differ

LocalPlayer.CharacterAdded:Connect(function(char)
    Character = char
end)

local function getMagnitudeTo(part)
    if not (Character and Character:FindFirstChild("HumanoidRootPart")) then return math.huge end
    return (part.Position - Character.HumanoidRootPart.Position).Magnitude
end

local function findNearest()
    local nearest, ndist = nil, math.huge
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") then
            for _, pat in ipairs(TargetNames) do
                if string.find(obj.Name:lower(), pat:lower()) then
                    local hrp = obj:FindFirstChild("HumanoidRootPart") or obj.PrimaryPart
                    if hrp then
                        local dist = getMagnitudeTo(hrp)
                        if dist < ndist and dist <= FarmRange then
                            nearest = obj
                            ndist = dist
                        end
                    end
                end
            end
        end
    end
    return nearest
end

local function moveTo(pos)
    local humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
    if humanoid then humanoid:MoveTo(pos) end
end

local function equipTool()
    for _, tool in ipairs(LocalPlayer.Backpack:GetChildren()) do
        if tool:IsA("Tool") then
            Character.Humanoid:EquipTool(tool)
            return tool
        end
    end
    for _, tool in ipairs(Character:GetChildren()) do
        if tool:IsA("Tool") then return tool end
    end
    return nil
end

local function attack(target)
    local hrp = Character and Character:FindFirstChild("HumanoidRootPart")
    local tpart = target:FindFirstChild("HumanoidRootPart") or target.PrimaryPart
    if hrp and tpart then
        moveTo(tpart.Position)
        local tool = equipTool()
        if tool and tool.Activate then
            tool:Activate()
        end
    end
end

task.spawn(function()
    while true do
        if AutoFarm then
            local target = findNearest()
            if target then
                attack(target)
            end
        end
        task.wait(Delay)
    end
end)

local Tab = Window:MakeTab({
    Name = "AutoFarm",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

Tab:AddToggle({
    Name = "Enable AutoFarm",
    Default = false,
    Callback = function(Value)
        AutoFarm = Value
    end
})

Tab:AddSlider({
    Name = "Farm Range",
    Min = 20,
    Max = 150,
    Default = FarmRange,
    Increment = 5,
    Callback = function(Value)
        FarmRange = Value
    end
})

Tab:AddSlider({
    Name = "Attack Radius",
    Min = 5,
    Max = 50,
    Default = AttackRadius,
    Increment = 1,
    Callback = function(Value)
        AttackRadius = Value
    end
})

Tab:AddSlider({
    Name = "Attack Delay (seconds)",
    Min = 0.05,
    Max = 1,
    Default = Delay,
    Increment = 0.05,
    Callback = function(Value)
        Delay = Value
    end
})

OrionLib:Init()
